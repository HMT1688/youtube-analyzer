<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ stats.title }} - ë¶„ì„ ê²°ê³¼</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .page-link.active { z-index: 10; color: #fff; background-color: #ef4444; border-color: #ef4444; }
        .loader { border: 4px solid #f3f3f3; border-top: 4px solid #ef4444; border-radius: 50%; width: 40px; height: 40px; animation: spin 1s linear infinite; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        #srt-text::-webkit-scrollbar { width: 8px; }
        #srt-text::-webkit-scrollbar-track { background: #f1f1f1; }
        #srt-text::-webkit-scrollbar-thumb { background: #d1d5db; border-radius: 4px; }
        #srt-text::-webkit-scrollbar-thumb:hover { background: #9ca3af; }
    </style>
</head>
<body class="bg-gray-100 p-4 sm:p-8 font-sans">
    <div class="relative flex justify-center min-h-screen">
        <!-- ì™¼ìª½ ê´‘ê³  ë°°ë„ˆ -->
        <aside class="hidden xl:block w-48 flex-shrink-0 p-4">
            <div class="sticky top-8 bg-white h-96 rounded-lg shadow-md flex items-center justify-center text-gray-400 border"><span>ì—¬ê¸°ì— ê´‘ê³ </span></div>
        </aside>

        <!-- ë©”ì¸ ì½˜í…ì¸  ì˜ì—­ -->
        <main class="w-full max-w-7xl">
            <!-- ì±„ë„ í—¤ë” -->
            <header class="bg-white p-6 rounded-lg shadow-md flex flex-col md:flex-row items-center space-y-4 md:space-y-0 md:space-x-6">
                <img src="{{ stats.profile_image }}" alt="í”„ë¡œí•„" class="w-24 h-24 rounded-full border-2 border-gray-200">
                <div class="flex-grow text-center md:text-left">
                    <h1 class="text-2xl md:text-3xl font-bold text-gray-800">{{ stats.title }}</h1>
                    <p class="text-gray-500 mt-1">êµ¬ë…ì {{ "{:,}".format(stats.subscribers) }}ëª… â€¢ ì˜ìƒ {{ "{:,}".format(stats.video_count) }}ê°œ</p>
                </div>
                <a href="/" class="text-sm text-blue-600 hover:underline mt-2 md:mt-0">&larr; ë‹¤ë¥¸ ì±„ë„ ë¶„ì„</a>
            </header>

            <!-- ì‹¬ì¸µ ë¶„ì„ -->
            <section class="mt-8">
                <h2 class="text-2xl font-bold text-gray-700 mb-4">ì±„ë„ ì‹¬ì¸µ ë¶„ì„</h2>
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-2 gap-4 md:gap-6">
                    <div class="bg-white p-4 rounded-lg shadow-md">
                        <h3 class="font-semibold text-gray-600 mb-2">ì½˜í…ì¸  ë¶„ì„</h3>
                        <div class="text-sm space-y-2">
                            <p><strong>ì£¼ê°„ í‰ê·  ì—…ë¡œë“œ:</strong> <span class="font-semibold text-blue-600">{{ analysis.uploads_per_week }} ê°œ</span></p>
                            <p><strong>í‰ê·  ì˜ìƒ ê¸¸ì´:</strong> <span class="font-semibold text-blue-600">{{ analysis.avg_duration }}</span></p>
                        </div>
                    </div>
                    <div class="bg-white p-4 rounded-lg shadow-md">
                        <h3 class="font-semibold text-gray-600 mb-2">ì‹œì²­ì ì°¸ì—¬ë„</h3>
                        <div class="text-sm space-y-2">
                            <p><strong>1ì²œë·° ë‹¹ ì¢‹ì•„ìš”:</strong> <span class="font-semibold text-green-600">{{ analysis.likes_per_1000_views }} ê°œ</span></p>
                            <p><strong>1ì²œë·° ë‹¹ ëŒ“ê¸€:</strong> <span class="font-semibold text-green-600">{{ analysis.comments_per_1000_views }} ê°œ</span></p>
                        </div>
                    </div>
                </div>
                <div class="bg-white p-4 rounded-lg shadow-md mt-4">
                     <h3 class="font-semibold text-gray-600 mb-2">ìµœê·¼ ì¸ê¸° TOP 5</h3>
                     <ul class="text-sm space-y-1">
                        {% for video in analysis.top_5_videos %}
                        <li class="truncate"><a href="{{ video.url }}" target="_blank" class="hover:text-red-500 transition-colors">ğŸ† {{ video.title }} ({{ "{:,}".format(video.views) }}íšŒ)</a></li>
                        {% endfor %}
                    </ul>
                </div>
            </section>
            
            <!-- ë™ì˜ìƒ ëª©ë¡ -->
            <section class="mt-8">
                <div class="flex justify-between items-center mb-4">
                     <h2 class="text-2xl font-bold text-gray-700">ë™ì˜ìƒ ëª©ë¡</h2>
                     <form id="sort-form" method="get" action="/analyze">
                        <input type="hidden" name="url" value="{{ original_url }}">
                        <select name="sortBy" onchange="document.getElementById('sort-form').submit()" class="text-sm border border-gray-300 rounded-lg px-2 py-1 focus:outline-none focus:ring-2 focus:ring-red-500">
                            <option value="published" {% if sort_by == 'published' %}selected{% endif %}>ìµœì‹ ìˆœ</option>
                            <option value="views" {% if sort_by == 'views' %}selected{% endif %}>ì¡°íšŒìˆ˜ìˆœ</option>
                            <option value="likes" {% if sort_by == 'likes' %}selected{% endif %}>ì¢‹ì•„ìš”ìˆœ</option>
                            <option value="comments" {% if sort_by == 'comments' %}selected{% endif %}>ëŒ“ê¸€ìˆœ</option>
                        </select>
                    </form>
                </div>
                <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-6">
                    {% for v in videos %}
                    <div class="bg-white rounded-lg shadow-md overflow-hidden flex flex-col">
                        <a href="{{ v.url }}" target="_blank"><img src="{{ v.thumb }}" alt="{{ v.title }}" class="w-full h-40 object-cover"></a>
                        <div class="p-4 flex flex-col flex-grow">
                            <h3 class="font-bold text-sm mb-2 flex-grow h-10 line-clamp-2">{{ v.title }}</h3>
                            <div class="text-xs text-gray-500 space-y-1 mb-3">
                                <p>ì¡°íšŒìˆ˜: <span class="font-medium">{{ "{:,}".format(v.views) }}</span></p>
                                <p>ì—…ë¡œë“œ: <span class="font-medium">{{ v.published.date() }}</span></p>
                            </div>
                            <div class="mt-auto pt-2 border-t border-gray-200 text-center text-xs space-x-2 font-semibold">
                                 <button onclick="showCaption('{{ v.id }}', false)" class="text-blue-600 hover:underline">ìë§‰</button>
                                 <span>|</span>
                                 <button onclick="showCaption('{{ v.id }}', true)" class="text-purple-600 hover:underline">AIìë§‰</button>
                                 <span>|</span>
                                 <a href="/download-video/{{ v.id }}" class="text-green-600 hover:underline">ë‹¤ìš´</a>
                            </div>
                        </div>
                    </div>
                    {% endfor %}
                </div>
            </section>

            <!-- í˜ì´ì§€ë„¤ì´ì…˜ ë²„íŠ¼ -->
            <nav class="mt-8 flex justify-center">
                <ul class="inline-flex items-center -space-x-px">
                     {% if current_page > 1 %}
                    <li><a href="/analyze?url={{ original_url }}&sortBy={{ sort_by }}&page={{ current_page - 1 }}" class="py-2 px-3 ml-0 leading-tight text-gray-500 bg-white rounded-l-lg border border-gray-300 hover:bg-gray-100">ì´ì „</a></li>
                    {% endif %}
                    {% set page_range = 5 %}
                    {% set start_page = [1, current_page - page_range // 2] | max %}
                    {% set end_page = [total_pages, start_page + page_range - 1] | min %}
                    {% if end_page - start_page + 1 < page_range %}
                        {% set start_page = [1, end_page - page_range + 1] | max %}
                    {% endif %}
                    
                    {% for p in range(start_page, end_page + 1) %}
                    <li><a href="/analyze?url={{ original_url }}&sortBy={{ sort_by }}&page={{ p }}" class="page-link py-2 px-3 leading-tight text-gray-500 bg-white border border-gray-300 hover:bg-gray-100 {% if p == current_page %}active{% endif %}">{{ p }}</a></li>
                    {% endfor %}

                    {% if current_page < total_pages %}
                    <li><a href="/analyze?url={{ original_url }}&sortBy={{ sort_by }}&page={{ current_page + 1 }}" class="py-2 px-3 leading-tight text-gray-500 bg-white rounded-r-lg border border-gray-300 hover:bg-gray-100">ë‹¤ìŒ</a></li>
                    {% endif %}
                </ul>
            </nav>
        </main>

         <!-- ì˜¤ë¥¸ìª½ ê´‘ê³  ë°°ë„ˆ -->
        <aside class="hidden xl:block w-48 flex-shrink-0 p-4">
            <div class="sticky top-8 bg-white h-96 rounded-lg shadow-md flex items-center justify-center text-gray-400 border"><span>ì—¬ê¸°ì— ê´‘ê³ </span></div>
        </aside>
    </div>

    <!-- âœ¨ ìë§‰ íŒì—…(ëª¨ë‹¬) âœ¨ -->
    <div id="caption-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center hidden z-50 p-4">
        <div class="bg-white rounded-lg shadow-xl w-full max-w-2xl max-h-[80vh] flex flex-col">
            <div class="flex justify-between items-center p-4 border-b">
                <h2 id="caption-title" class="text-lg font-bold text-gray-800 truncate">ìë§‰ ë‚´ìš©</h2>
                <button onclick="closeModal()" class="text-gray-500 hover:text-gray-800 text-2xl font-bold">&times;</button>
            </div>
            <div id="caption-content" class="p-4 sm:p-6 overflow-y-auto">
                <div id="loader" class="flex justify-center items-center h-48"><div class="loader"></div></div>
                <pre id="srt-text" class="font-mono text-sm whitespace-pre-wrap break-words hidden"></pre>
            </div>
             <div class="p-3 border-t text-right bg-gray-50 rounded-b-lg">
                <button id="copy-button" onclick="copyCaption()" class="bg-gray-200 text-gray-700 text-xs font-bold py-1 px-3 rounded hover:bg-gray-300 transition">ë³¸ë¬¸ ë³µì‚¬</button>
            </div>
        </div>
    </div>

    <script>
        const modal = document.getElementById('caption-modal');
        const captionTitle = document.getElementById('caption-title');
        const srtText = document.getElementById('srt-text');
        const loader = document.getElementById('loader');
        const copyButton = document.getElementById('copy-button');

        async function showCaption(videoId, isAi) {
            modal.classList.remove('hidden');
            loader.style.display = 'flex';
            srtText.classList.add('hidden');
            srtText.textContent = '';
            captionTitle.textContent = 'ìë§‰ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...';
            copyButton.textContent = 'ë³¸ë¬¸ ë³µì‚¬';
            const url = isAi ? `/get-caption-ai/${videoId}` : `/get-caption/${videoId}`;
            try {
                const response = await fetch(url);
                const data = await response.json();
                loader.style.display = 'none';
                if (data.error) { srtText.textContent = `ì˜¤ë¥˜: ${data.error}`; } 
                else {
                    captionTitle.textContent = data.title;
                    srtText.textContent = data.srt_content;
                }
                srtText.classList.remove('hidden');
            } catch (error) {
                loader.style.display = 'none';
                srtText.textContent = 'ìë§‰ì„ ê°€ì ¸ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ë„¤íŠ¸ì›Œí¬ ì—°ê²°ì„ í™•ì¸í•´ì£¼ì„¸ìš”.';
                srtText.classList.remove('hidden');
            }
        }
        function closeModal() { modal.classList.add('hidden'); }
        function copyCaption() {
            if (navigator.clipboard) {
                 navigator.clipboard.writeText(srtText.textContent).then(() => {
                    copyButton.textContent = 'ë³µì‚¬ ì™„ë£Œ!';
                    setTimeout(() => { copyButton.textContent = 'ë³¸ë¬¸ ë³µì‚¬'; }, 2000);
                }).catch(err => { alert('ìë§‰ ë³µì‚¬ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.'); });
            } else {
                const textarea = document.createElement('textarea');
                textarea.value = srtText.textContent;
                document.body.appendChild(textarea);
                textarea.select();
                try {
                    document.execCommand('copy');
                    copyButton.textContent = 'ë³µì‚¬ ì™„ë£Œ!';
                    setTimeout(() => { copyButton.textContent = 'ë³¸ë¬¸ ë³µì‚¬'; }, 2000);
                } catch (err) { alert('ìë§‰ ë³µì‚¬ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.'); }
                document.body.removeChild(textarea);
            }
        }
        window.onclick = (event) => { if (event.target == modal) closeModal(); }
        document.addEventListener('keydown', (event) => { if (event.key === "Escape") closeModal(); });
    </script>
</body>
</html>
